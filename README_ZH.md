[English](README.md) | 中文

# FaLa
 订阅世界，简单易用！

---

## 项目简介

Fala 是一个开源的自定义订阅工具，旨在帮助用户轻松管理和查看关心的数据。通过简单易用的功能和跨平台支持，Fala 将订阅体验提升到一个全新高度。

---

### 核心功能

#### 自定义订阅管理
- 用户可以通过输入链接或扫描二维码，快速添加订阅源。
- 支持多种数据源，满足不同场景需求。

#### 桌面小部件
- 支持将订阅数据直接添加到桌面小部件。
- 通过小部件快速查看关心的数据，一目了然。
- 支持按小部件尺寸分别设置订阅源

#### 订阅分享
- 支持分享订阅源链接，方便与他人共享内容。
- 分享方式包括直接复制链接或生成二维码。

#### 订阅更新设置
- 支持用户自定义订阅更新的时间间隔。
- 灵活的更新频率，确保数据保持最新的同时节省资源。

#### 订阅管理功能
- **通过拖动排序**：用户可拖动订阅列表中的项目，自定义排序顺序，满足个性化需求。
- **隐藏订阅**：可将订阅从主界面隐藏，避免干扰视图。
- **删除订阅**：支持彻底移除不再需要的订阅项。
### Cloud 同步
- 支持在 Apple 设备间通过 iCloud 同步订阅数据。
- 用户可在 iPhone、iPad、Mac 等设备间无缝切换，订阅数据始终保持一致。
---

### 使用指南

#### 添加订阅
- 打开 Fala 应用，点击 “添加订阅”。
- 选择以下任意方式添加订阅：
- **扫描二维码**：通过内置的扫描功能，快速获取订阅源信息。
- **手动输入**：直接输入订阅链接，点击确认即可添加。

#### 查看和管理订阅
- 订阅内容将以列表形式显示，用户可通过点击进入详情页查看。
- 提供以下管理功能：
- **拖动排序**：长按订阅项，拖动到目标位置，即可完成排序。
- **隐藏订阅**：左滑订阅项右侧菜单中选择 “隐藏”，订阅将从主界面消失，但仍可在隐藏订阅列表中查看和恢复。
- **删除订阅**：在订阅管理中左滑订阅链接右侧菜单中选择 “删除”，订阅将永久在您的设备上删除，同一订阅链接下的所有订阅也将删除

#### 桌面小部件
- 长按手机桌面，添加 Fala 的小部件。
- 选择要展示的订阅项，直接在桌面查看数据。
- 支持大中小三种小部件

#### 分享订阅
- 在订阅管理页面长期选择需要分享的订阅链接，选择复制链接或生成二维码。
- 支持选择多个链接一起分享
- 将二维码或链接分享给好友，让他们快速添加该订阅源。

#### 设置订阅更新间隔
- 左滑订阅项右侧菜单中选择 “设置”

#### 开启 iCloud 同步
- 在**关于Fala**页面开启 **iCloud 同步**
- 登录 Apple ID 后，订阅数据会自动上传到 iCloud 并同步到其他设备。
- 用户可以在任意 Apple 设备上查看和管理同步的数据。

---

### 技术实现

#### UI层
- 使用 Flutter 的 ReorderableListView 实现拖动排序功能，提供流畅的交互体验。
- 添加 iCloud 同步开关，允许用户轻松启用或禁用同步功能。

#### 逻辑层
- 使用 Provider 管理订阅数据状态，并与 iCloud 数据同步逻辑集成
- 在每次订阅数据修改后，实时同步到 iCloud，同时监听 iCloud 数据更新，及时刷新界面。

#### 数据层
- **本地存储**：使用**shared_preferences**保存订阅数据，作为本地缓存
- **云存储**：利用 Apple 的 CloudKit 实现 iCloud 同步功能。

---

### 开发进度

| 功能|  状态|  备注| 
|-------|-------|-------|
| 添加订阅（链接/二维码）| 	✅ 已完成|
| 桌面小部件支持	| ✅ 已完成| 	Android 和 iOS 均支持|
| 分享订阅	| ✅ 已完成	| 复制链接和生成二维码|
| 更新间隔设置	| ✅ 已完成| 	支持多种时间间隔选择|
| 拖动排序	| ✅ 已完成| 	使用 ReorderableListView|
| 隐藏订阅	| ✅ 已完成| 	支持恢复隐藏订阅|
| 删除订阅	| ✅ 已完成|
| iCloud 同步	| ✅ 已完成	| 基于 CloudKit 实现同步|
| 性能优化	| 🔄 开发中	| 持续优化网络请求逻辑| 

---

### 数据格式

#### 订阅数据格式
| 字段名     | 类型       | 描述 |
|---------|----------|-------|
| title   | string   | 订阅标题
| sources | []object | 订阅数据源

#### 订阅源格式
| 字段名     | 类型       | 描述                                             |
|---------|----------|------------------------------------------------|
| data_type   | string   | 返回的数据类型\[ text \| html \| image \| markdown \] 
| url   | string   | 订阅源地址                                          
| type   | string   | 位置类型\[ content \| preview \| widget_small \| widget_middle\| widget_large \]                           

#### 位置类型说明
| 类型 | 描述     |
|----|--------|
| content| 详情页    |
| preview| 订阅项预览  |
| widget_small| 小组件    |
| widget_middle| 中尺寸小组件 |
| widget_large| 大尺寸小组件 |

#### 数据示例
```json
[
	{
		"title": "K线图",
		"sources": [
			{
				"data_type": "html",
				"url": "http://xx.com/subscription/kline_content.html",
				"type": "content",
				"proxy": "PROXY 192.168.15.32:10021"
			},
			{
				"data_type": "image",
				"url": "http://xx.com/subscription/kline.png",
				"type": "preview"
			},
			{
				"data_type": "image",
				"url": "http://xx.com/subscription/kline_2_2.png",
				"type": "widget_small"
			},
			{
				"data_type": "text",
				"url": "http://xx.com/subscription/kline_4_2.txt",
				"type": "widget_middle"
			}
		]
	}
]
```

#### 服务器输出
```js
let json = JSON.stringify([
	{...},
	...
]);
res.send(Buffer.from(json).toString('base64'));
```

---

### 用户体验提升点
- **拖动排序的实时保存**：订阅顺序调整后立即保存到本地存储，并同步到 iCloud。

---

### 未来规划
- 增加订阅内容分类管理功能（如新闻、博客、社交媒体等）。
- 支持订阅内容的关键字过滤和快速搜索。
- 增加桌面平台支持，如 macOS 和 Windows，并支持 iCloud 同步。
- 提供通知提醒功能，及时推送订阅更新的重要内容。